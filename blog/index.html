<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Blog</title>
  <meta name="description" content="To be figured out soon.">

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="https://kw7oe.github.io/blog/">
  <link rel="alternate" type="application/rss+xml" title="kw7oe" href="/feed.xml">

  
</head>


  <body>
    
    <header class="site-header" role="banner">
  <div class="main-col">
    
    

    
      <nav class="navbar" role="navigation" aria-label="main navigation">
        <div class="navbar-brand"><a href="/">kw7oe</a></div>
        <div class="navbar-item"><a href="/categories">Categories</a></div>
      </nav>
    
  </div>
</header>

    
    <div class="section">
  <main class="main-col" aria-label="Content">
    <article class="blog">
  
    <div class="post">
  <!-- Headeer -->
   <header class="post-header">
     <h1 class="post-title" itemprop="name headline">Minimal Elixir Web Application with Plug and Cowboy</h1>
     <p class="post-meta">
       <time datetime="2018-10-14T15:32:00+08:00" itemprop="datePublished">
         
         Oct 14, 2018
       </time>
       </p>
   </header>

   <!-- Main Article -->
   <div class="post-content" itemprop="articleBody">
     <p>It is interesting to learn things from scratch. Coming from Ruby
background, I was curious what is the equivalent of Sinatra in
Elixir. It’s called Plug. It is what Phoenix build on top of.</p>

<p>Using Sinatra, we can write a quick and simple web server with the following
code:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'sinatra'</span>
<span class="nb">require</span> <span class="s1">'json'</span>

<span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">content_type</span> <span class="ss">:json</span>
  <span class="no">JSON</span><span class="p">({</span><span class="ss">message: </span><span class="s2">"Hello World"</span><span class="p">})</span>
<span class="k">end</span>
</code></pre></div></div>

<p>How can we achive that in Elixir? With <code class="highlighter-rouge">Plug</code> and <code class="highlighter-rouge">Cowboy</code>.</p>

<h2 id="setup">Setup</h2>

<p><em><strong>NOTE</strong>: This article is based on Elixir v1.7.3</em></p>

<p>First of all, let’s create a <code class="highlighter-rouge">mix</code> project and change directory into it.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mix new sample_app
<span class="nb">cd </span>sample_app
</code></pre></div></div>

<p>Open <code class="highlighter-rouge">mix.exs</code> file with your favourite editor. And add the dependencies as
follow:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defp</span> <span class="n">deps</span> <span class="k">do</span>
  <span class="p">[</span>
    <span class="p">{</span><span class="ss">:cowboy</span><span class="p">,</span> <span class="sd">"</span><span class="s2">~&gt; 2.0"</span><span class="p">},</span>
    <span class="p">{</span><span class="ss">:plug</span><span class="p">,</span> <span class="sd">"</span><span class="s2">~&gt; 1.0"</span><span class="p">}</span>
    <span class="c1"># {:dep_from_hexpm, "~&gt; 0.3.0"},</span>
    <span class="c1"># {:dep_from_git, git: "https://github.com/elixir-lang/my_dep.git", tag: "0.1.0"},</span>
  <span class="p">]</span>
<span class="k">end</span>
</code></pre></div></div>

<p>We add <code class="highlighter-rouge">Plug</code> and <code class="highlighter-rouge">Cowboy</code> as dependencies because <code class="highlighter-rouge">Cowboy</code> act as  a web server and
<code class="highlighter-rouge">Plug</code> on the other hand, act as a connection adapter to the web server.</p>

<p>Before we proceed, let’s get all the dependencies first by running the
following command:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mix deps.get
</code></pre></div></div>

<h2 id="using-plug">Using Plug</h2>
<p><code class="highlighter-rouge">Plug</code> can be complicated if we don’t understand it. The
best way to understand it, is to, read the <a href="https://github.com/elixir-plug/plug#hello-world">documentation</a> <em>(In fact, all the
steps mentioned above and below are already available in the documentation)</em>.</p>

<p>So to get a taste of how <code class="highlighter-rouge">Plug</code> works, let’s just copy and paste the code from
the documentation and make some changes. Let’s create <code class="highlighter-rouge">lib/my_plug.ex</code> and
and add in the code.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>touch lib/my_plug.ex
</code></pre></div></div>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">SampleApp</span><span class="o">.</span><span class="no">MyPlug</span> <span class="k">do</span>
  <span class="kn">import</span> <span class="no">Plug</span><span class="o">.</span><span class="no">Conn</span>

  <span class="k">def</span> <span class="n">init</span><span class="p">(</span><span class="n">options</span><span class="p">)</span> <span class="k">do</span>
    <span class="c1"># initialize options</span>

    <span class="n">options</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">call</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">_opts</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">conn</span>
    <span class="o">|&gt;</span> <span class="n">put_resp_content_type</span><span class="p">(</span><span class="sd">"</span><span class="s2">text/plain"</span><span class="p">)</span>
    <span class="o">|&gt;</span> <span class="n">send_resp</span><span class="p">(</span><span class="m">200</span><span class="p">,</span> <span class="sd">"</span><span class="s2">Hello world"</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Let’s try to run the code.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>iex -S mix

iex(1)&gt; {:ok, _} = Plug.Adapters.Cowboy2.http SampleApp.MyPlug, []
</code></pre></div></div>

<p>Now let’s go and visit <a href="http://localhost:4000" target="_blank">http://localhost:4000</a>.
You should be able to see a “Hello World” on your browser.
We just start the <code class="highlighter-rouge">cowboy</code> web server in <code class="highlighter-rouge">iex</code>, by passing it our <code class="highlighter-rouge">Plug</code> and <code class="highlighter-rouge">[]</code>
empty arguments.</p>

<h2 id="thats-all">That’s all</h2>
<p>Yes, you have wrote a simple web server using Elixir.</p>

<p><em>Wait, wait, but how can I run my server through command line? I have to run
<code class="highlighter-rouge">iex -S mix</code> and start the <code class="highlighter-rouge">Cowboy</code> server manually every time?</em></p>

<p><strong>Nope.</strong> We can make it an OTP application. So that we just need to run <code class="highlighter-rouge">mix
run --no-halt</code> or <code class="highlighter-rouge">iex -S mix</code> and the <code class="highlighter-rouge">cowboy</code> server will boot up itself.</p>

<h2 id="basic-of-otp-application">Basic of OTP Application</h2>

<p>OTP application is basically a component that has predefined behaviour. It can
be started, loaded or stopped. To create an OTP application in Elixir, we
use the <code class="highlighter-rouge">Application</code> module and implements some of the expected behavior. For
more you can always refer to the documentation of <a href="https://hexdocs.pm/elixir/Application.html">Application</a>.</p>

<p>So let’s create a simple application first.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>touch lib/app.ex
</code></pre></div></div>
<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">SampleApp</span><span class="o">.</span><span class="no">App</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">Application</span>
  <span class="k">def</span> <span class="n">start</span><span class="p">(</span><span class="n">_type</span><span class="p">,</span> <span class="n">_args</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">IO</span><span class="o">.</span><span class="n">puts</span> <span class="sd">"</span><span class="s2">Starting application"</span>
    <span class="n">children</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="no">Supervisor</span><span class="o">.</span><span class="n">start_link</span><span class="p">(</span><span class="n">children</span><span class="p">,</span> <span class="ss">strategy:</span> <span class="ss">:one_for_one</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Now if you run <code class="highlighter-rouge">mix run --no-halt</code>, you still won’t see the “Starting
application” output yet. This is because we haven’t configure our <code class="highlighter-rouge">mix.exs</code>
yet.</p>

<p>To make <code class="highlighter-rouge">mix</code> run our application, we have to add the following code into
<code class="highlighter-rouge">mix.exs</code>:</p>
<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">application</span> <span class="k">do</span>
  <span class="p">[</span>
    <span class="ss">extra_applications:</span> <span class="p">[</span><span class="ss">:logger</span><span class="p">],</span>
    <span class="ss">mod:</span> <span class="p">{</span><span class="no">SampleApp</span><span class="o">.</span><span class="no">App</span><span class="p">,</span> <span class="p">[]}</span> <span class="c1"># Add in this line of code</span>
  <span class="p">]</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Now, if we run <code class="highlighter-rouge">mix run --no-halt</code>, we can finally see the “Starting
application…” output. It also means we have sucessfully start an OTP
application.</p>

<h2 id="starting-cowboy-server-automatically">Starting Cowboy Server automatically</h2>

<p>Remember how we run our <code class="highlighter-rouge">cowboy</code> server in <code class="highlighter-rouge">iex</code>?</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>iex -S mix

iex(1)&gt; {:ok, _} = Plug.Adapters.Cowboy2.http SampleApp.MyPlug, []
</code></pre></div></div>

<p>Now after knowing how to start our OTP application with <code class="highlighter-rouge">mix run --no-halt</code> or
<code class="highlighter-rouge">iex -S mix</code>, we need to start our <code class="highlighter-rouge">cowboy</code> server after our application is
started.</p>

<p>To do this, we need to modify the <code class="highlighter-rouge">start/2</code> method in the <code class="highlighter-rouge">app.ex</code>.</p>
<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">start</span><span class="p">(</span><span class="n">_type</span><span class="p">,</span> <span class="n">_args</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">children</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># Define workers and child supervisors to be supervised</span>
    <span class="no">Plug</span><span class="o">.</span><span class="no">Adapters</span><span class="o">.</span><span class="no">Cowboy2</span><span class="o">.</span><span class="n">child_spec</span><span class="p">(</span><span class="ss">scheme:</span> <span class="ss">:http</span><span class="p">,</span> <span class="ss">plug:</span> <span class="no">SampleApp</span><span class="o">.</span><span class="no">MyPlug</span><span class="p">,</span> <span class="ss">options:</span> <span class="p">[</span><span class="ss">port:</span> <span class="m">4000</span><span class="p">])</span>
  <span class="p">]</span>

  <span class="no">Supervisor</span><span class="o">.</span><span class="n">start_link</span><span class="p">(</span><span class="n">children</span><span class="p">,</span> <span class="ss">strategy:</span> <span class="ss">:one_for_one</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>What we are doing here is to specify the child spec of the child process, which
is our <code class="highlighter-rouge">cowboy</code>. A child specification basically tell the supervisor how to
start, restart or shutdown the child process. The above code is also mentioned
in the documentation of Plug under <a href="https://hexdocs.pm/plug/readme.html#supervised-handlers">Supervised handlers</a>.</p>

<p>Now, if we run the <code class="highlighter-rouge">mix run --no-halt</code>, and visit <a href="http://localhost:4000" target="_blank">http://localhost:4000</a>.</p>

<p>Our web application is now online.</p>

<h2 id="summary">Summary</h2>

<p>If you’re a beginner to OTP or Elixir, there are a lots of stuff underneath
that I didn’t cover well. This is my first blog post on Elixir. It might be lacking.
So here are some other resources you can refer to:</p>

<ul>
  <li><a href="https://elixirschool.com/en/lessons/specifics/plug/">Elixir School Plug</a><a href="#one"><sup>1</sup></a></li>
  <li><a href="https://hexdocs.pm/plug/readme.html">Plug documentation</a></li>
  <li><a href="https://hexdocs.pm/elixir/Application.html">Application documentation</a></li>
  <li><a href="https://hexdocs.pm/elixir/Supervisor.html">Supervisor documentation</a></li>
</ul>

<p><em>The source code of the project is available at <a href="https://github.com/kw7oe/plug_sample_app">GitHub</a>.</em></p>

<hr />
<ol>
  <li><small id="one">To be honest, <strong>Elixir School does a better job in explaining this topic</strong>.
The way I’m writing is based on how my thought process flow, so it might be
different and unstructured. This post also covers less topics about using
Plug compared to Elixir School.
</small></li>
</ol>


   </div>
</div>
    <hr>
  
    <div class="post">
  <!-- Headeer -->
   <header class="post-header">
     <h1 class="post-title" itemprop="name headline">A note on`application` in mix.exs starting from Elixir 1.4</h1>
     <p class="post-meta">
       <time datetime="2018-10-03T21:45:00+08:00" itemprop="datePublished">
         
         Oct 3, 2018
       </time>
       </p>
   </header>

   <!-- Main Article -->
   <div class="post-content" itemprop="articleBody">
     <p>Starting from Elixir 1.4, we don’t need to specify our application lists in
<code class="highlighter-rouge">application</code>. It is automatically inferred from our dependencies. <em>(Check the
release notes <a href="https://elixir-lang.org/blog/2017/01/05/elixir-v1-4-0-released/">here</a>)</em></p>

<p>Do note that <strong>it only automatically infer the application lists if the
<code class="highlighter-rouge">:applications</code> key is empty.</strong> If you had already declared your it in your
<code class="highlighter-rouge">mix.exs</code> like this:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">application</span> <span class="k">do</span>
  <span class="p">[</span>
    <span class="c1"># Will be automatically inferred starting</span>
    <span class="c1"># from Elixir 1.4, if it is empty.</span>
    <span class="ss">applications:</span> <span class="p">[</span><span class="ss">:cowboy</span><span class="p">,</span> <span class="ss">:plug</span><span class="p">]</span>
  <span class="p">]</span>
<span class="k">end</span>
</code></pre></div></div>
<p>Be sure to clear it to utilize this feature.</p>

<p>Below are the detailed story on how I came across this.</p>

<p><small><em>Disclaimer: The point of this article is summed up above, skip the part below if you’re busy.</em></small></p>

<hr />

<h3 id="the-story">The Story</h3>

<p>Recently, I have been writing a simple Plug web application and came across the
need to use an external database.</p>

<p><code class="highlighter-rouge">Ecto</code> and <code class="highlighter-rouge">PostgreSQl</code> is the thing that come up to my mind.</p>

<p>Hence, I went over the <a href="https://hexdocs.pm/ecto/getting-started.html#content">Ecto documentation</a> and run through the setup in the
application. After going through the steps, and finally run <code class="highlighter-rouge">iex -S mix</code>, an
error arise.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...failed to start child: App.Repo
</code></pre></div></div>

<p>I check my <code class="highlighter-rouge">config.exs</code>. Nothing wrong.</p>

<p>So, I go through the documentation again and again, to check if I miss out anything.
No, nothing wrong. The documentation didn’t mentioned the need to add <code class="highlighter-rouge">ecto</code>
and <code class="highlighter-rouge">postgrex</code> in the <code class="highlighter-rouge">application</code>.  After googling around, someone mentioned
that adding it solve the issues.</p>

<p><em>I tried, it worked.</em></p>

<p>But I don’t know why. <em>The documentation can’t be wrong right?</em></p>

<p>So, I create a new test application and follow the documentation again.</p>

<p><em>And, it works.</em></p>

<p>So, I delete this line of code in my <code class="highlighter-rouge">mix.exs</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="ss">applications:</span> <span class="p">[</span><span class="ss">:cowboy</span><span class="p">,</span> <span class="ss">:plug</span><span class="p">]</span>
</code></pre></div></div>

<p><em>And, it works.</em></p>

<h3 id="the-why">The Why</h3>
<p>Hence, I guess that Mix actaully automatically start the applications needed
for us. So, I search through the documentations of different version of Mix
<em>(<a href="https://hexdocs.pm/mix/1.3.4/Mix.Tasks.Compile.App.html#content">1.4.5</a> vs <a href="https://hexdocs.pm/mix/1.3.4/Mix.Tasks.Compile.App.html#content">1.3.4</a>)</em>, and finally found out that since Elixir 1.4,
Mix has this new feature. It is also mentioned in the <a href="https://elixir-lang.org/blog/2017/01/05/elixir-v1-4-0-released/">release notes of Elixir 1.4</a>.</p>

<p>However there is one condition. <strong>It only automatically infer the applications list if the
<code class="highlighter-rouge">:applications</code> key is empty.</strong> That explains why it didn’t work in my
application because I already declared the list manually, as shown below:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">application</span> <span class="k">do</span>
  <span class="p">[</span>
    <span class="ss">mod:</span> <span class="p">{</span><span class="no">App</span><span class="o">.</span><span class="no">App</span><span class="p">,</span> <span class="p">[]},</span>
    <span class="ss">extra_applications:</span> <span class="p">[</span><span class="ss">:logger</span><span class="p">],</span>
    <span class="c1"># Can be removed for Elixir &gt;= 1.4.</span>
    <span class="c1"># Since it is automatically inferred.</span>
    <span class="ss">applications:</span> <span class="p">[</span><span class="ss">:cowboy</span><span class="p">,</span> <span class="ss">:plug</span><span class="p">]</span>
  <span class="p">]</span>
<span class="k">end</span>
</code></pre></div></div>

<h3 id="the-lessons">The Lessons</h3>

<ul>
  <li>Application lists can be automatically inferred in for Elixir &gt;= 1.4</li>
  <li><em>Documentation can be wrong. But, most of the time, you might be the one who
are in fault.</em></li>
  <li>Read release notes.</li>
</ul>

<p>Thanks for reading through it.</p>


   </div>
</div>
    <hr>
  
    <div class="post">
  <!-- Headeer -->
   <header class="post-header">
     <h1 class="post-title" itemprop="name headline">Using AWK to extract generated file from jekyll-compose</h1>
     <p class="post-meta">
       <time datetime="2018-09-09T22:25:00+08:00" itemprop="datePublished">
         
         Sep 9, 2018
       </time>
       </p>
   </header>

   <!-- Main Article -->
   <div class="post-content" itemprop="articleBody">
     <p>Recently, I have been using <code class="highlighter-rouge">jekyll</code> to make notes. I use <code class="highlighter-rouge">jekyll-compose</code>
gem to create post using command line. However, the auto open generated file
features isn’t working in my machine after the setup.</p>

<p>After a few times on manually opening the generated files in <code class="highlighter-rouge">vim</code>, I decided
to write a quick shell script to solve this issue.</p>

<h3 id="scenario">Scenario</h3>
<p>To generate a new post with <code class="highlighter-rouge">jekyll-compose</code>, we can run the following command:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bundle exec jekyll post &lt;TITLE&gt;
</code></pre></div></div>

<p>and it will output the following:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Configuration file: /Users/kai/Desktop/notes/_config.yml
New post created at _posts/&lt;DATE&gt;-&lt;TITLE&gt;
</code></pre></div></div>

<p>So, to generate and open the file involves the following steps:</p>

<ul>
  <li>Run the command to generate post</li>
  <li>Extract the file path</li>
  <li>Open the file using <code class="highlighter-rouge">vim</code></li>
</ul>

<h3 id="awk">awk</h3>
<p>I came across <code class="highlighter-rouge">AWK</code> from <a href="https://twitter.com/b0rk/status/1000604334026055681">Julia Evans zine</a>. It came to my mind again when I want
to extract the file path from the output of the command.</p>

<p><code class="highlighter-rouge">AWK</code> is a programming language designed for text-processing. It has very basic
yet important command <code class="highlighter-rouge">print</code> to output the text. What makes <code class="highlighter-rouge">AWK</code> different is
it breaks each line into columns <em>(seperated by space, which can be configure)</em>, where:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>print $1
</code></pre></div></div>

<p>means output the first column.</p>

<p>We can also add in a specific condition in front of the <code class="highlighter-rouge">print</code> command so that
it only execute if the condition is true.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CONDITION {print $1}
</code></pre></div></div>

<h3 id="implementation">Implementation</h3>
<p>After knowing some basic of <code class="highlighter-rouge">AWK</code>, we can extract the file path with the
following actions.</p>

<h4 id="1-extraction">1. Extraction</h4>
<p>Hence, to extract out the file path from the line <code class="highlighter-rouge">New post created at _posts/&lt;DATE&gt;-&lt;TITLE&gt;</code>,
we can use the following command:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>echo 'New post created at _posts/&lt;DATE&gt;-&lt;TITLE&gt;' | awk '{print $5}'
</code></pre></div></div>

<p><code class="highlighter-rouge">$5</code> is used since the file path is the fifth column of the line.</p>

<h4 id="2-only-extract-second-line">2. Only Extract Second Line</h4>
<p>Since we just wanted to extract the second line of the command output, the
command above is not enough. What we really wanted is to say:</p>

<p><em>if the line is second row, then we extract it</em></p>

<p>To achieve that in <code class="highlighter-rouge">AWK</code>, we can use <code class="highlighter-rouge">AWK</code> built-in variables <code class="highlighter-rouge">FNR</code>, which
refers to the current line number of the file, to form a condition.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>echo -e "Configuration file: /Users/kai/Desktop/notes/_config.yml\nNew post created at _posts/&lt;DATE&gt;-&lt;TITLE&gt;" | awk 'FNR==2{ print $5 }'
</code></pre></div></div>

<h3 id="summary">Summary</h3>
<ol>
  <li>You can use <code class="highlighter-rouge">AWK</code> to print specific column of lines with <code class="highlighter-rouge">awk {print $N}</code></li>
  <li>You can add condition in front of the <code class="highlighter-rouge">print</code> command if needed.</li>
  <li><code class="highlighter-rouge">AWK</code> contains a handful of built-in variables that are useful for
text-processing.</li>
  <li>Code snippet to generate and open the file.
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function </span>newpost<span class="o">()</span> <span class="o">{</span>
  vim <span class="k">$(</span>
 bundle <span class="nb">exec </span>jekyll post <span class="nv">$1</span> |
 <span class="c"># substr is used to remove the ending '.' of the extracted string</span>
 <span class="nb">awk</span> <span class="s1">'FNR == 2{print substr($5, 1, length($5) - 1)}'</span>
  <span class="k">)</span>
<span class="o">}</span>
</code></pre></div>    </div>
  </li>
</ol>

<hr />
<ol>
  <li>
    <p>If you are interested in more command line tools, you can consider purchase
<a href="https://twitter.com/b0rk">Julia Evans</a> <a href="https://gumroad.com/l/bite-size-command-line">Byte Size Command Line</a> zine series.</p>
  </li>
  <li>
    <p>It turns out the reason why my <code class="highlighter-rouge">jekyll-compose</code> configuration doesn’t work is
  because of a single typo of <code class="highlighter-rouge">-</code>. Instead of:</p>
    <div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># The correct one</span>
<span class="na">jekyll_compose</span><span class="pi">:</span>
  <span class="na">auto_open</span><span class="pi">:</span> <span class="no">true</span>
</code></pre></div>    </div>
    <p>I use:</p>
    <div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># The wrong one</span>
<span class="na">jekyll-compose</span><span class="pi">:</span>
  <span class="na">auto_open</span><span class="pi">:</span> <span class="no">true</span>
</code></pre></div>    </div>
  </li>
</ol>


   </div>
</div>
    <hr>
  
    <div class="post">
  <!-- Headeer -->
   <header class="post-header">
     <h1 class="post-title" itemprop="name headline">A note about using &#39;fetch&#39; in JS</h1>
     <p class="post-meta">
       <time datetime="2018-04-11T00:00:00+08:00" itemprop="datePublished">
         
         Apr 11, 2018
       </time>
       </p>
   </header>

   <!-- Main Article -->
   <div class="post-content" itemprop="articleBody">
     <p>Another story about fixing bug. This story is related to the native web
API <code class="highlighter-rouge">fetch</code>, which is used to make request.</p>

<h3 id="backstory">Backstory</h3>
<p>After serveral days of having my first production application online,
my client inform me that, the application has a bug, <em>again</em>.
The button was not working as expected for one of the users.
Long story short, we found out that the bug occurs in iOS 10.2.1.
So, I downloaded the Simulator for iOS 10.2 to start debugging.</p>

<h3 id="issue">Issue</h3>
<p>It turns out that <code class="highlighter-rouge">fetch</code> is not supported in iOS 10.2. In this
case, I can:</p>
<ul>
  <li>replace <code class="highlighter-rouge">fetch</code> with <code class="highlighter-rouge">axios</code></li>
  <li>use <code class="highlighter-rouge">fetch</code> polyfill</li>
</ul>

<p>to solve the issue.</p>

<h3 id="lesson-learned">Lesson Learned</h3>
<ol>
  <li><code class="highlighter-rouge">fetch</code> is not supported for iOS 10.2 and below.</li>
  <li>How to debug a web application using Simulator.</li>
  <li>Having more information about the environment when the bug occured
is always helpful.</li>
</ol>


   </div>
</div>
    <hr>
  
    <div class="post">
  <!-- Headeer -->
   <header class="post-header">
     <h1 class="post-title" itemprop="name headline">Using Ruby next in map</h1>
     <p class="post-meta">
       <time datetime="2018-03-28T00:00:00+08:00" itemprop="datePublished">
         
         Mar 28, 2018
       </time>
       </p>
   </header>

   <!-- Main Article -->
   <div class="post-content" itemprop="articleBody">
     <p>While I was refactoring the code base of my client application,
I came accross a code block, similar to this:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">arr</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">data</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">d</span><span class="o">|</span>
  <span class="n">status</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">'status'</span><span class="p">]</span>
  <span class="k">next</span> <span class="k">if</span> <span class="no">IGNORED_STATUS</span><span class="p">.</span><span class="nf">include?</span> <span class="n">status</span>
  <span class="n">arr</span> <span class="o">&lt;&lt;</span> <span class="n">d</span><span class="p">[</span><span class="s1">'value'</span><span class="p">]</span>
<span class="k">end</span>
</code></pre></div></div>

<p>I think, “Ha, I can replace <code class="highlighter-rouge">each</code> with <code class="highlighter-rouge">map</code> here.”</p>

<p>I go ahead, and make the changes.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">arr</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="nf">map</span> <span class="k">do</span> <span class="o">|</span><span class="n">d</span><span class="o">|</span>
  <span class="n">status</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">'status'</span><span class="p">]</span>
  <span class="k">next</span> <span class="k">if</span> <span class="no">IGNORED_STATUS</span><span class="p">.</span><span class="nf">include?</span> <span class="n">status</span>
  <span class="n">d</span><span class="p">[</span><span class="s1">'value'</span><span class="p">]</span>
<span class="k">end</span>
</code></pre></div></div>

<p><em>Little did I know that,
this will  break the production system in the future.</em></p>

<p>After the application went live, after a few hours, my client
reported that there were errors in the system disrupting the user from
using it normally. After some investigation, I found out that it is
caused by <code class="highlighter-rouge">nil</code>. I patched the error quickly by using <code class="highlighter-rouge">compact</code>.</p>

<p>From something like this:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">timeslots</span> <span class="o">=</span> <span class="n">get_timeslots</span><span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="c1"># [1, nil, 2, 3]</span>
<span class="n">timeslots</span><span class="p">.</span><span class="nf">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="o">...</span> <span class="p">}</span>
</code></pre></div></div>

<p>to:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">timeslots</span> <span class="o">=</span> <span class="n">get_timeslots</span><span class="p">(</span><span class="n">params</span><span class="p">).</span><span class="nf">compact</span> <span class="c1"># [1, 2, 3]</span>
<span class="n">timeslots</span><span class="p">.</span><span class="nf">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="o">...</span> <span class="p">}</span>
</code></pre></div></div>

<p>Later on, diving into the source code, I found out that the <code class="highlighter-rouge">nil</code>
is introduced by my own refactored code. It turns out that, inside
a <code class="highlighter-rouge">map</code>, using <code class="highlighter-rouge">next</code> will return <code class="highlighter-rouge">nil</code> instead of skipping it
altogether. I only learn this when I came across this
<a href="http://code-worrier.com/blog/map-and-next/">blog article</a>.
For example:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">arr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span>
<span class="n">arr</span><span class="p">.</span><span class="nf">map</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
  <span class="k">next</span> <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span>
  <span class="n">i</span> <span class="c1"># Return the value</span>
<span class="k">end</span>

<span class="c1">#=&gt; return [1, nil, 3, nil, 5, nil]</span>
<span class="c1">#=&gt; instead of [1, 3, 5]</span>
</code></pre></div></div>

<p>Well, thanks myself for not writing test ahead before refactoring the
code base, I get to learn this the hard way.</p>

<h3 id="lesson-learned">Lesson Learned</h3>
<ol>
  <li>Always write test before refactoring.</li>
  <li>Using <code class="highlighter-rouge">next</code> in a <code class="highlighter-rouge">map</code> return <code class="highlighter-rouge">nil</code></li>
  <li><code class="highlighter-rouge">Array#compact</code> can be used to remove <code class="highlighter-rouge">nil</code> elements.</li>
</ol>


   </div>
</div>
    <hr>
  

  
<nav class="pagination is-centered" role="navigation" aria-label="pagination">
  
  <!-- Previous Page -->
  
    <a class="pagination-previous" disabled>Prev</a>
  
  
  <!-- Next Page -->
  
    <a href="/blog/page-2" class="pagination-next">Next &raquo;</a>
  
</div>

</article>

  </main>
</div>
    
    <footer class="footer">
  <div class="main-col">
    
      <a class="footer-link" href="https://github.com/kw7oe" target="_blank"><span class="icon icon--github"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">kw7oe</span></a>

    

    
      <a class="footer-link" href="https://twitter.com/kw7oe" target="_blank"><span class="icon icon--twitter"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">kw7oe</span></a>

    
  </div>
</footer>

    <script src="/assets/custom.js"></script> 
  </body>

</html>
