<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Blog</title>
  <meta name="description" content="">

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="https://kw7oe.github.io/blog/">
  <link rel="alternate" type="application/rss+xml" title="kw7oe" href="/feed.xml">

  
</head>


  <body>

    <header class="site-header" role="banner">
  <div class="main-col">
    
    

    
      <nav class="navbar" role="navigation"
        aria-label="main navigation">
        

<div class="navbar-brand">
<a href="/"
   >
  Home
</a>
</div>

        

<div class="navbar-item">
<a href="/categories"
   >
  Categories
</a>
</div>

        

<div class="navbar-item">
<a href="/about"
   >
  About
</a>
</div>

      </nav>
      
  </div>
</header>


    <div class="section">
  <main class="main-col" aria-label="Content">
    <article class="blog">
  
    <div class="post">
  <!-- Headeer -->
   <header class="post-header">
     <h1 class="post-title" itemprop="name headline">Using Tesseract OCR in Elixir/Phoenix</h1>
     <p class="post-meta">
       <time datetime="2019-06-03T18:04:00+08:00" itemprop="datePublished">
         
         Jun 3, 2019
       </time>
       </p>
   </header>

   <!-- Main Article -->
   <div class="post-content" itemprop="articleBody">
     <p>Lately, I am exploring the use of OCR in <a href="https://expendere.herokuapp.com">Expendere</a> (my expense tracking
application) and came across <a href="https://github.com/tesseract-ocr/tesseract">Tesseract OCR</a>.</p>

<p>At the time of writing this blog post, there is no native binding of Tesseract OCR in Elixir.
However, there are two Elixir wrapper available on GitHub:</p>

<ul>
  <li><a href="https://github.com/dannnylo/tesseract-ocr-elixir">tesseract-ocr-elixir</a></li>
  <li><a href="https://github.com/bchase/tesseract-elixir">tesseract-elixir</a></li>
</ul>

<p>Both wrapper use <code class="highlighter-rouge">System.cmd/3</code> to invoke the <code class="highlighter-rouge">tesseract</code> command line
interface and return the results of the executed command.</p>

<p>Seeing there are wrappers available out there, I quickly grab one and scaffold
a Phoenix application to test it out.</p>

<h2 id="code">Code</h2>

<p>In this code example, I will be using wrapper from <a href="https://github.com/dannnylo/tesseract-ocr-elixir">tesseract-ocr-elixir</a>.</p>

<p>In <code class="highlighter-rouge">mix.exs</code>, add <code class="highlighter-rouge">tesseract-ocr-elixir</code> as dependency:</p>
<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">deps</span> <span class="k">do</span>
  <span class="p">[</span>
    <span class="o">...</span><span class="p">,</span>
    <span class="p">{</span><span class="ss">:tesseract_ocr</span><span class="p">,</span> <span class="sd">"</span><span class="s2">~&gt; 0.1.0"</span><span class="p">}</span>
  <span class="p">]</span>
<span class="k">end</span>
</code></pre></div></div>

<p>In <code class="highlighter-rouge">page_controller.ex</code>:</p>
<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">OcrWeb</span><span class="o">.</span><span class="no">PageController</span> <span class="k">do</span> <span class="kn">use</span> <span class="no">OcrWeb</span><span class="p">,</span> <span class="ss">:controller</span>

  <span class="k">def</span> <span class="n">index</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">_params</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">render</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="sd">"</span><span class="s2">index.html"</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">create</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="p">%{</span><span class="sd">"</span><span class="s2">upload"</span> <span class="o">=&gt;</span> <span class="p">%</span><span class="no">Plug</span><span class="o">.</span><span class="no">Upload</span><span class="p">{}</span> <span class="o">=</span> <span class="n">upload</span><span class="p">})</span> <span class="k">do</span>
    <span class="n">result</span> <span class="o">=</span> <span class="no">TesseractOcr</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">upload</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
    <span class="n">render</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="sd">"</span><span class="s2">show.html"</span><span class="p">,</span> <span class="ss">result:</span> <span class="n">result</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

</code></pre></div></div>

<p>In <code class="highlighter-rouge">router.ex</code>, add this under <code class="highlighter-rouge">scope "/"</code>:</p>
<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">get</span> <span class="sd">"</span><span class="s2">/"</span><span class="p">,</span> <span class="no">PageController</span><span class="p">,</span> <span class="ss">:index</span>
<span class="n">post</span> <span class="sd">"</span><span class="s2">/upload"</span><span class="p">,</span> <span class="no">PageController</span><span class="p">,</span> <span class="ss">:create</span>
</code></pre></div></div>

<p>In <code class="highlighter-rouge">templates/page/index.html.eex</code>:</p>
<pre><code class="language-eex">&lt;%= form_for @conn, Routes.page_path(@conn, :create),
                    [multipart: true], fn f-&gt; %&gt;
    &lt;%= file_input f, :upload, class: "form-control" %&gt;
    &lt;%= submit "Upload", class: "btn btn-primary" %&gt;
&lt;% end %&gt;
</code></pre>

<p>In <code class="highlighter-rouge">templates/page/show.html.eex</code>:</p>
<pre><code class="language-eex">&lt;h1&gt;Result:&lt;/h1&gt;

&lt;%= @result %&gt;
</code></pre>

<p><strong>Demo</strong></p>

<p><img src="/assets/image/tesseract-demo.gif" alt="Demo" /></p>

<p>Voila, a simple OCR application is done. The demo application is available at <a href="https://github.com/kw7oe/phoenix-ocr-demo">GitHub</a>.</p>


   </div>
</div>
    <hr>
  
    <div class="post">
  <!-- Headeer -->
   <header class="post-header">
     <h1 class="post-title" itemprop="name headline">Send temporary file in Phoenix</h1>
     <p class="post-meta">
       <time datetime="2019-05-28T20:59:00+08:00" itemprop="datePublished">
         
         May 28, 2019
       </time>
       </p>
   </header>

   <!-- Main Article -->
   <div class="post-content" itemprop="articleBody">
     <p><strong>TLDR:</strong> Use <code class="highlighter-rouge">Phoenix.Controller.send_download/3</code> to send binary as download
to your users.</p>

<hr />

<p>In Phoenix, there are a couple ways of to send file to your users.
The most straightforward one is to programmatically create a file and send
it to user using <code class="highlighter-rouge">Plug.Conn.send_file/5</code>.</p>

<p>For example:</p>
<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">export</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">_params</span><span class="p">)</span> <span class="k">do</span>
  <span class="c1"># Create file</span>
  <span class="n">filename</span> <span class="o">=</span> <span class="sd">"</span><span class="s2">test.md"</span>
  <span class="no">File</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="sd">"</span><span class="s2">Hello World"</span><span class="p">)</span>

  <span class="c1"># Send file</span>
  <span class="n">conn</span>
  <span class="o">|&gt;</span> <span class="n">put_resp_header</span><span class="p">(</span><span class="sd">"</span><span class="s2">content-disposition"</span><span class="p">,</span> <span class="sx">~s(attachment; filename="#{filename}")</span><span class="p">)</span>
  <span class="o">|&gt;</span> <span class="n">send_file</span><span class="p">(</span><span class="m">200</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>However, this approach <strong>creates a file locally in your production server
and require some clean up</strong> after that. <em>(I donâ€™t really know how to delete a file only after the request succeed)</em></p>

<h2 id="introducing-send_download3">Introducing <code class="highlighter-rouge">send_download/3</code></h2>

<p>Luckily, there is another approach, which is using <code class="highlighter-rouge">Phoenix.Controller.send_download/3</code>.
This function allow us to send binary directly as a download. Hence, file creation is not needed.</p>

<p>For example:</p>
<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">export</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">_params</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">filename</span> <span class="o">=</span> <span class="sd">"</span><span class="s2">test.md"</span>

  <span class="c1"># Send file</span>
  <span class="n">conn</span>
  <span class="o">|&gt;</span> <span class="n">send_download</span><span class="p">({</span><span class="ss">:binary</span><span class="p">,</span> <span class="sd">"</span><span class="s2">Hello World"</span><span class="p">},</span> <span class="ss">filename:</span> <span class="n">filename</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>For more, refer to the <a href="https://hexdocs.pm/plug/Plug.Conn.html#send_file/5"><code class="highlighter-rouge">send_file/5</code></a> and <a href="https://hexdocs.pm/phoenix/Phoenix.Controller.html#send_download/3">send_download/3</a> documentation.</p>

<hr />
<p><small>This post was first appeared in my <a href="https://til.kaiwern.com/posts/54">TIL web application</a>.</small></p>


   </div>
</div>
    <hr>
  
    <div class="post">
  <!-- Headeer -->
   <header class="post-header">
     <h1 class="post-title" itemprop="name headline">How I keep track of tasks for multiple side projects</h1>
     <p class="post-meta">
       <time datetime="2019-03-31T20:51:00+08:00" itemprop="datePublished">
         
         Mar 31, 2019
       </time>
       </p>
   </header>

   <!-- Main Article -->
   <div class="post-content" itemprop="articleBody">
     <p>If you are like me, having countless side projects and jumping from one to another
from time to time, you might also experience <em>ending up losing track of what
you should do on each side projects.</em></p>

<p>Keeping track of tasks in all of your side projects isnâ€™t easy without using
any project management software. However, it might feel overkill for personal
projects.</p>

<p>How might one solve it? With a simple <strong>text file and some bash script</strong>.</p>

<h3 id="where-i-left-off-last-time">Where I left off last time?</h3>

<p>Every now and then, when I am working on my side projects, I always forget
what are the last changes I made. Luckily with version control and the
practice of writing good commit message, I can always use <code class="highlighter-rouge">git log</code> to
view the past commits to get an overview what I should do next and
what have been done.</p>

<p>However, this approach is limited. Sometime, the past commits canâ€™t really
tell me what should I do next.</p>

<p>Hence, I use a simple way to keep track of what I need to do in my side
projects, which is a todo list. To be more accurate, a project based todo list,
in a simple file.</p>

<h3 id="introducing-todo-file">Introducing <code class="highlighter-rouge">.todo</code> file</h3>

<p>The idea is straighforward. I write down my tasks in the <code class="highlighter-rouge">.todo</code> file located
at the root directory of the project.</p>

<p>To edit it, I just use <code class="highlighter-rouge">vim .todo</code>. Adding tasks or deleting tasks are the
same as manipulating text. If youâ€™re not a <code class="highlighter-rouge">vim</code> user, you can use any text
editor you prefer.</p>

<h3 id="listing-the-tasks">Listing the tasks</h3>

<p>To get what you need to do on each side projects, is simple. The simplest
apporach is to <code class="highlighter-rouge">cat -n .todo</code>. This command will show your task in your <code class="highlighter-rouge">.todo</code>
file, numbered.</p>

<p>In cases where you have wrote a lot of tasks, listing out just like this might
clutter your terminal. To resolve this, we can use <code class="highlighter-rouge">head</code> to show only the top
few tasks on the <code class="highlighter-rouge">.todo</code> file. Now our command becomes:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat -n .todo | head -n 5
</code></pre></div></div>

<p>This command will list the top 5 line of your file. To take it further, you can
write a bash function and add it to your <code class="highlighter-rouge">.bashrc</code> or <code class="highlighter-rouge">.zshrc</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function </span>whattodo<span class="o">()</span> <span class="o">{</span>
    <span class="nb">cat</span> <span class="nt">-n</span> .todo
<span class="o">}</span>
</code></pre></div></div>

<p>Now, everytime I need to know what I need to do for each side projects, I just
<code class="highlighter-rouge">cd</code> into project directory and run my <code class="highlighter-rouge">whattodo</code> command.</p>

<h3 id="benefits">Benefits</h3>

<p>No extra dependencies is needed. Since, we use the comamnds that are widely
available and also cross compatible to every machine Unix based machine.</p>

<hr />

<h2 id="final-thoughts">Final Thoughts</h2>

<p>There are no silver bullets to manage a project. Different project size, might
need different toolings and approach. For instance,  this approach is not really
suitable when the project become too large or complex, where the tasks involved
consists of different type of work such as bug fixes, adding features and etc.</p>

<p>For a small, personal side project, I found this method to be quite helpful personally.</p>


   </div>
</div>
    <hr>
  
    <div class="post">
  <!-- Headeer -->
   <header class="post-header">
     <h1 class="post-title" itemprop="name headline">TIL: Indexing `NULL` in Oracle Database</h1>
     <p class="post-meta">
       <time datetime="2019-02-18T21:32:00+08:00" itemprop="datePublished">
         
         Feb 18, 2019
       </time>
       </p>
   </header>

   <!-- Main Article -->
   <div class="post-content" itemprop="articleBody">
     <p>Oracle database does not index a row if all the indexed columns are <code class="highlighter-rouge">NULL</code></p>

<p>For instance, let say we have a <code class="highlighter-rouge">users</code> table where we index <code class="highlighter-rouge">role</code> column to improve the query performance.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span> <span class="k">WHERE</span> <span class="k">role</span> <span class="k">IS</span> <span class="k">NULL</span>
</code></pre></div></div>

<p>The index does not work for such query in Oracle database. This is because when Oracle database is inserting the new record of <code class="highlighter-rouge">user</code> where the <code class="highlighter-rouge">role</code> is <code class="highlighter-rouge">NULL</code>, it does not add the created row to the index. Hence, the index is not useful when querying with <code class="highlighter-rouge">NULL</code></p>

<h3 id="solutions">Solutions</h3>

<p>Use a constant expression that can never be <code class="highlighter-rouge">NULL</code>.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">users_role</span> <span class="k">ON</span> <span class="n">users</span> <span class="p">(</span><span class="k">role</span><span class="p">,</span> <span class="s1">'user'</span><span class="p">)</span>
</code></pre></div></div>

<p>or we can use a concatenated index (multi-column index) and ensure that the the other column of the index must have a <code class="highlighter-rouge">NOT NULL</code> constraint.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">users_role</span> <span class="k">ON</span> <span class="n">users</span> <span class="p">(</span><span class="k">role</span><span class="p">,</span> <span class="n">id</span><span class="p">)</span>
</code></pre></div></div>

<p>For more detailed explanation and source, refer to <a href="https://use-the-index-luke.com/sql/where-clause/null">NULL in Oracle Database</a></p>

<hr />
<p><small>This post was first appeared in my TIL web application at <a href="https://til.kaiwern.com/posts/4">here</a>.</small></p>


   </div>
</div>
    <hr>
  
    <div class="post">
  <!-- Headeer -->
   <header class="post-header">
     <h1 class="post-title" itemprop="name headline">Advent of Code 2018: Day 1 Part 2, How I improve my solution by 34x faster</h1>
     <p class="post-meta">
       <time datetime="2018-12-01T22:10:00+08:00" itemprop="datePublished">
         
         Dec 1, 2018
       </time>
       </p>
   </header>

   <!-- Main Article -->
   <div class="post-content" itemprop="articleBody">
     <p>In the <a href="/aoc/elixir/2018/12/01/advent-of-code-2018-day-1-part-1.html">previous post</a>, we had briefly discuss about the solution of Part 1. It
is fairly straightforward. I thought Part 2 is going to be easy too. But man,
I was wrong. It is a bit tricky.</p>

<p><strong>My initial solution takes around 17 seconds to compute the answer</strong>.  I
<strong>made it 34x faster</strong> by changing the data structure. In the end,
the improved solution solves the puzzle in just <strong>0.5 seconds</strong>.</p>

<p><em>Code is available at <a href="https://github.com/kw7oe/advent-of-code-2018">GitHub</a>. For those who just want to know how the solution
improved by 34x faster, see <a href="#three">here</a>.</em></p>

<p>Okay, thatâ€™s the end of some irrelavant stuff. Letâ€™s jump straight to the puzzle of Part 2.</p>

<h2 id="part-2">Part 2</h2>

<p>Part 2 still uses the same inputs as Part 1.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-9
+7 +5
-13
+6
...
-23
-46
-27
-11
-75223
</code></pre></div></div>

<p>This time, the question and scenario are abit different, which make it
tricky.</p>

<p>The problem description states that:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>You notice that the device repeats the same frequency change list over and over. To calibrate the device, you need to find the first frequency it reaches twice.
</code></pre></div></div>

<p><strong>For example:</strong></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Here are other examples:

    +1, -1 first reaches 0 twice.
    +3, +3, +4, -2, -4 first reaches 10 twice.
    -6, +3, +8, +5, -6 first reaches 5 twice.
    +7, +7, -2, -7, -4 first reaches 14 twice.

Note that your device might need to repeat its list of frequency changes many times before a duplicate frequency is found, and that duplicates might be found while in the middle of processing the list.
</code></pre></div></div>

<p>And the question is:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>What is the first frequency your device reaches twice?
</code></pre></div></div>

<h3 id="problem-breakdown">Problem Breakdown</h3>

<p>So the question is asking for the first frequency that reaches twice. But, do
note that <strong>the frequency list can be repeated many times before an asnwer is
found</strong>.</p>

<p>If after the first interation of the frequency list, there is no duplicate
found, the frequency list will go through the second interation again. This
only stops until a duplicate frequency found.</p>

<p>To summarize:</p>

<ul>
  <li>Find first duplicate of frequency.</li>
  <li>Repeat the frequency list if no duplicate frequency found. <a href="#one"><sup>1</sup></a></li>
  <li>The initial frequency is 0.</li>
  <li>Upon second iteration, the current frequency will be resumed from the previosu
iteration. <a href="#two"><sup>2</sup></a></li>
</ul>

<h3 id="initial-solution">Initial Solution</h3>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">Finder</span> <span class="k">do</span>
  <span class="k">def</span> <span class="n">is_duplicate?</span><span class="p">(</span><span class="n">frequency</span><span class="p">,</span> <span class="n">appeared_frequencies</span><span class="p">)</span> <span class="k">do</span>
    <span class="c1"># Check if the frequency is duplicate in appeared_frequencies</span>
    <span class="k">if</span> <span class="no">Enum</span><span class="o">.</span><span class="n">member?</span><span class="p">(</span><span class="n">appeared_frequencies</span><span class="p">,</span> <span class="n">frequency</span><span class="p">)</span> <span class="k">do</span>

      <span class="c1"># Return :halt to halt the reduce_while loop</span>
      <span class="c1"># and the duplicate</span>
      <span class="p">{</span><span class="ss">:halt</span><span class="p">,</span> <span class="n">frequency</span><span class="p">}</span>
    <span class="k">else</span>
      <span class="c1"># Update the appeared_frequencies to include the new frequency</span>

      <span class="c1"># Prepend [ element_to_add | rest_of_list ] is used since it</span>
      <span class="c1"># has a constant time of adding element to list.</span>
      <span class="n">appeared_frequencies</span> <span class="o">=</span> <span class="p">[</span> <span class="n">frequency</span> <span class="o">|</span> <span class="n">appeared_frequencies</span> <span class="p">]</span>

      <span class="c1"># Return :cont to continue the reduce_while loop</span>
      <span class="c1"># with the frequency and updated appeared_frequencies</span>
      <span class="p">{</span><span class="ss">:cont</span><span class="p">,</span> <span class="p">{</span><span class="n">frequency</span><span class="p">,</span> <span class="n">appeared_frequencies</span><span class="p">}}</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">accumulate_and_find</span><span class="p">(</span><span class="n">frequencies</span><span class="p">,</span> <span class="n">initial</span><span class="p">,</span> <span class="n">past_frequencies</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">frequencies</span>
     <span class="c1"># The accumulator for reduce_while is:</span>

     <span class="c1">#   initial/prev_frequency -&gt; Initial/Previous Frequency,</span>
     <span class="c1">#   past_frequencies/appeared_frequencies -&gt; Past Appeared Frequencies /</span>
     <span class="c1">#                                            Appeared Frequencies</span>
    <span class="o">|&gt;</span> <span class="no">Enum</span><span class="o">.</span><span class="n">reduce_while</span><span class="p">({</span><span class="n">initial</span><span class="p">,</span> <span class="n">past_frequencies</span><span class="p">},</span>
      <span class="k">fn</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">{</span><span class="n">prev_frequency</span><span class="p">,</span> <span class="n">appeared_frequencies</span><span class="p">})</span>  <span class="o">-&gt;</span>

        <span class="c1"># Calculate the new frequency.</span>
        <span class="n">new_frequency</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">prev_frequency</span>

        <span class="c1"># Check if the new frequency is a duplicate</span>

        <span class="c1"># Halt if it is.</span>
        <span class="c1"># Continue the reduce_while if it is not.</span>
        <span class="n">is_duplicate?</span><span class="p">(</span><span class="n">new_frequency</span><span class="p">,</span> <span class="n">appeared_frequencies</span><span class="p">)</span>
      <span class="k">end</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">find_first_duplicate_frequency</span><span class="p">(</span><span class="n">frequencies</span><span class="p">,</span> <span class="n">initial</span><span class="p">,</span> <span class="n">past_frequencies</span><span class="p">)</span> <span class="k">do</span>
    <span class="k">case</span> <span class="n">accumulate_and_find</span><span class="p">(</span><span class="n">frequencies</span><span class="p">,</span> <span class="n">initial</span><span class="p">,</span> <span class="n">past_frequencies</span><span class="p">)</span> <span class="k">do</span>
      <span class="c1"># No duplicates found</span>
      <span class="p">{</span><span class="n">result</span><span class="p">,</span> <span class="n">appeared_frequencies</span><span class="p">}</span> <span class="o">-&gt;</span>
        <span class="c1"># Recursively call this method</span>
        <span class="c1"># by passing in the frequencies again.</span>

        <span class="c1"># However, the next iteration `initial` frequency will be the previous</span>
        <span class="c1"># iteration frequency, which is the value of `result`.</span>

        <span class="c1"># The `appeared_frequencies in the previous iteration will be pass</span>
        <span class="c1"># forward to the next iteration too.</span>

        <span class="n">find_first_duplicate_frequency</span><span class="p">(</span><span class="n">frequencies</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">appeared_frequencies</span><span class="p">)</span>

      <span class="c1"># Duplicate found</span>
      <span class="n">result</span> <span class="o">-&gt;</span> <span class="n">result</span> <span class="c1"># Return duplicate and end recursive call.</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">case</span> <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="sd">"</span><span class="s2">input.txt"</span><span class="p">)</span> <span class="k">do</span>
  <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">content</span><span class="p">}</span> <span class="o">-&gt;</span>
    <span class="n">frequencies</span> <span class="o">=</span> <span class="n">content</span>
                  <span class="o">|&gt;</span> <span class="no">String</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                  <span class="o">|&gt;</span> <span class="no">Enum</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="no">String</span><span class="o">.</span><span class="n">to_integer</span><span class="o">/</span><span class="m">1</span><span class="p">)</span>

    <span class="no">Finder</span><span class="o">.</span><span class="n">find_first_duplicate_frequency</span><span class="p">(</span><span class="n">frequencies</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="p">[</span><span class="m">0</span><span class="p">])</span>
    <span class="o">|&gt;</span> <span class="no">IO</span><span class="o">.</span><span class="n">inspect</span>
  <span class="p">{</span><span class="ss">:error</span><span class="p">,</span> <span class="n">_</span><span class="p">}</span> <span class="o">-&gt;</span> <span class="no">IO</span><span class="o">.</span><span class="n">puts</span> <span class="sd">"</span><span class="s2">Error opening files"</span>
<span class="k">end</span>
</code></pre></div></div>

<p>If the comments in the code is not sufficient, here are the more detailed
explanation to help you understand the code <em>(hopefully)</em>:</p>

<ol>
  <li>First, same as Part 1, we read the content from the file, split it and
conver every element into integer first.</li>
  <li>Then, we pass it into <code class="highlighter-rouge">Finder.find_first_duplicate_frequency/3</code> method,
with the <code class="highlighter-rouge">frequencies</code>, initial frequency, and appeared frequencies.</li>
  <li>In <code class="highlighter-rouge">ind_first_duplicate_frequency</code>, it will delegate the finding
duplicate job to <code class="highlighter-rouge">accumulate_and_find/3</code> and check if the return result
is a found duplicate or not.
    <ul>
      <li>If there is no duplicate found, it will call itself recursively, with the same <code class="highlighter-rouge">frequencies</code>,
to start the next iteration.</li>
      <li>The initial frequency will be replaced with the last frequency from the previous iteration.</li>
      <li>The appeared frequencies from the previous iteration will also be pass forward
to the next iteration.</li>
    </ul>
  </li>
  <li>In <code class="highlighter-rouge">accumulate_and_find/3</code>, we use <code class="highlighter-rouge">Map.reduce_while/3</code> to map through each
elements in the <code class="highlighter-rouge">frequencies</code> and keep track of the previous frequency and
appeared frequencies.
    <ul>
      <li><code class="highlighter-rouge">reduce_while/3</code> is used so that we can control when to <code class="highlighter-rouge">halt</code> the
 looping.</li>
      <li>It accepts an accumulator, which in this case is our <code class="highlighter-rouge">{ initial,
past_frequencies }</code>, which indicates the state we want to keep track of
while mapping through the elements</li>
      <li>It also accepts a function, which in this case, will be used to calculate
the new frequency, by <code class="highlighter-rouge">new_frequency = x + prev_frequency</code> and check
if it is a duplicate using <code class="highlighter-rouge">is_duplicate?/2</code>.</li>
    </ul>
  </li>
  <li>In <code class="highlighter-rouge">is_duplicate?/2</code>, it basically check if the element already existed
by <code class="highlighter-rouge">Enum.member/2?</code>.
    <ul>
      <li>If it exists, it return <code class="highlighter-rouge">:halt</code> and the duplicate to the <code class="highlighter-rouge">reduce_while</code>
code block. Thus, ending the loop.</li>
      <li>Else, it return <code class="highlighter-rouge">:cont</code> with the current frequency and the new appeared
frequencies to the <code class="highlighter-rouge">reduce_while/3</code> code block.</li>
    </ul>
  </li>
</ol>

<p><strong>Performance:</strong></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ time elixir part-2.ex

real	0m17.047s
user	0m16.978s
sys	0m0.184s
</code></pre></div></div>

<p>At first, I thought I am having infinity loop and was kind of disappointed as
it was my forth time fixing the solution. Then, I jrealized, it
just take a long time to compute the answer.</p>

<p>After a few hours, I started to think about how to
improve the performance. Then, I realized why it took so long.</p>

<h3 id="improved-solution">Improved Solution</h3>
<p>It is beacuse of the use of <code class="highlighter-rouge">List</code>. <code class="highlighter-rouge">Enum.member?/2</code> will iterate through every
single element until it find the member. So, when there is a new element
added to <code class="highlighter-rouge">appeared_frequency</code>, it has to loop through additional element in the
<code class="highlighter-rouge">Enum.member?/2</code>.</p>

<p>Looping through the <code class="highlighter-rouge">frequencies</code> itself is already an <em>O(n)</em> operation. With,
 <code class="highlighter-rouge">Enum.member?/2</code>, thatâ€™s another <em>O(n)</em> operation.Thus, resulting in a <em>O(n^2)</em>
 solution.</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">Finder</span> <span class="k">do</span>

  <span class="k">def</span> <span class="n">is_duplicate?</span><span class="p">(</span><span class="n">frequency</span><span class="p">,</span> <span class="n">appeared_frequencies</span><span class="p">)</span> <span class="k">do</span>
    <span class="c1"># Use Map.has_key?/2 to check if the frequency already existed</span>
    <span class="k">if</span> <span class="no">Map</span><span class="o">.</span><span class="n">has_key?</span><span class="p">(</span><span class="n">appeared_frequencies</span><span class="p">,</span> <span class="n">frequency</span><span class="p">)</span> <span class="k">do</span>
      <span class="p">{</span><span class="ss">:halt</span><span class="p">,</span> <span class="n">frequency</span><span class="p">}</span>
    <span class="k">else</span>
      <span class="c1"># Use Map.put/3 to add the new frequency in to the map.</span>
      <span class="n">appeared_frequencies</span> <span class="o">=</span> <span class="no">Map</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">appeared_frequencies</span><span class="p">,</span> <span class="n">frequency</span><span class="p">,</span> <span class="m">0</span><span class="p">)</span>
      <span class="p">{</span><span class="ss">:cont</span><span class="p">,</span> <span class="p">{</span><span class="n">frequency</span><span class="p">,</span> <span class="n">appeared_frequencies</span><span class="p">}}</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">accumulate_and_find</span><span class="p">(</span><span class="n">frequencies</span><span class="p">,</span> <span class="n">initial</span><span class="p">,</span> <span class="n">past_frequencies</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">frequencies</span>
    <span class="o">|&gt;</span> <span class="no">Enum</span><span class="o">.</span><span class="n">reduce_while</span><span class="p">({</span><span class="n">initial</span><span class="p">,</span> <span class="n">past_frequencies</span><span class="p">},</span>
      <span class="k">fn</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">{</span><span class="n">prev_frequency</span><span class="p">,</span> <span class="n">appeared_frequencies</span><span class="p">})</span>  <span class="o">-&gt;</span>
        <span class="n">new_frequency</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">prev_frequency</span>
        <span class="n">is_duplicate?</span><span class="p">(</span><span class="n">new_frequency</span><span class="p">,</span> <span class="n">appeared_frequencies</span><span class="p">)</span>
      <span class="k">end</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">find_first_duplicate_frequency</span><span class="p">(</span><span class="n">frequencies</span><span class="p">,</span> <span class="n">initial</span><span class="p">,</span> <span class="n">past_frequencies</span><span class="p">)</span> <span class="k">do</span>
    <span class="k">case</span> <span class="n">accumulate_and_find</span><span class="p">(</span><span class="n">frequencies</span><span class="p">,</span> <span class="n">initial</span><span class="p">,</span> <span class="n">past_frequencies</span><span class="p">)</span> <span class="k">do</span>
      <span class="p">{</span><span class="n">result</span><span class="p">,</span> <span class="n">appeared_frequencies</span><span class="p">}</span> <span class="o">-&gt;</span>
        <span class="n">find_first_duplicate_frequency</span><span class="p">(</span><span class="n">frequencies</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">appeared_frequencies</span><span class="p">)</span>
      <span class="n">result</span> <span class="o">-&gt;</span> <span class="n">result</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>


<span class="k">case</span> <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="sd">"</span><span class="s2">input.txt"</span><span class="p">)</span> <span class="k">do</span>
  <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">content</span><span class="p">}</span> <span class="o">-&gt;</span>
    <span class="n">frequencies</span> <span class="o">=</span> <span class="n">content</span>
                  <span class="o">|&gt;</span> <span class="no">String</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                  <span class="o">|&gt;</span> <span class="no">Enum</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="no">String</span><span class="o">.</span><span class="n">to_integer</span><span class="o">/</span><span class="m">1</span><span class="p">)</span>

    <span class="c1"># Subsitute [0] to %{0 =&gt; 0} to represent the appeared frequencies.</span>
    <span class="no">Finder</span><span class="o">.</span><span class="n">find_first_duplicate_frequency</span><span class="p">(</span><span class="n">frequencies</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="p">%{</span><span class="m">0</span> <span class="o">=&gt;</span> <span class="m">0</span><span class="p">})</span>
    <span class="o">|&gt;</span> <span class="no">IO</span><span class="o">.</span><span class="n">inspect</span>
  <span class="p">{</span><span class="ss">:error</span><span class="p">,</span> <span class="n">_</span><span class="p">}</span> <span class="o">-&gt;</span> <span class="no">IO</span><span class="o">.</span><span class="n">puts</span> <span class="sd">"</span><span class="s2">Error opening files"</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The second solution is just to switch the data structure we used to store the
<code class="highlighter-rouge">appeared_frequencies</code>. Instead of <code class="highlighter-rouge">List</code>, we use a <code class="highlighter-rouge">Map</code>. <code class="highlighter-rouge">Map</code> has a
constant look up time <em>O(1)</em> to access the element. Hence, it improve the
performance of the solution.</p>

<p><em>By using the right data structure, with a change of 3 lines of code,
we successfully improve the execution speed of our program by <strong>34x</strong> faster.</em></p>

<p><strong>Performance:</strong></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ time elixir part-2.ex

real	0m0.517s
user	0m0.481s
sys	0m0.188s
</code></pre></div></div>

<p>Day 1 Part 2, Done.</p>

<hr />
<p><strong>Footnote</strong></p>

<ol>
  <li><small id="one">
At first, I didnâ€™t notice this and submitted the wrong answer.
</small></li>
  <li><small id="two">
Then I submitted the wrong answer again, as I didnâ€™t use the last frequency
from the previous iteration while starting the next iterationâ€¦
</small></li>
  <li><small id="three">I replace the data structure to keep track
of the appeared frequencies <em>(which required lookup)</em> from <code class="highlighter-rouge">List</code> to <code class="highlighter-rouge">Map</code>.
</small></li>
</ol>


   </div>
</div>
    <hr>
  

  
<nav class="pagination is-centered" role="navigation" aria-label="pagination">
  
  <!-- Previous Page -->
  
    <a class="pagination-previous" disabled>Prev</a>
  
  
  <!-- Next Page -->
  
    <a href="/blog/page-2" class="pagination-next">Next &raquo;</a>
  
</div>

</article>

  </main>
</div>

    <footer class="footer">
  <div class="main-col">
    
      <a class="footer-link" href="https://github.com/kw7oe" target="_blank"><span class="icon icon--github"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">kw7oe</span></a>

    

    
      <a class="footer-link" href="https://twitter.com/kw7oe" target="_blank"><span class="icon icon--twitter"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">kw7oe</span></a>

    
  </div>
</footer>

  </body>

</html>
