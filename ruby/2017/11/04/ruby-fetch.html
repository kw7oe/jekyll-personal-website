<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Ruby fetch</title>
  <meta name="description" content="Today, when I am refactoring a CLI I wrote, I came across a code block where I check whether an index exists in an array (turns out I don’t actually need it,...">

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="https://kw7oe.github.io/ruby/2017/11/04/ruby-fetch.html">
  <link rel="alternate" type="application/rss+xml" title="kw7oe" href="/feed.xml">

  
</head>


  <body>

    

    <div class="section">
  <main class="main-col" aria-label="Content">
    <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Ruby fetch</h1>
    <small class="post-meta">
      <time datetime="2017-11-04T22:43:41+08:00" itemprop="datePublished">
        
        Nov 4, 2017
      </time>
      </small>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>Today, when I am refactoring a CLI I wrote, I came across a code block  where I check whether an index exists in an array <em>(turns out I don’t actually need it, I can just access the array and check if the value is <code class="highlighter-rouge">nil</code>)</em>. I went to search of Ruby <code class="highlighter-rouge">Array</code> documentation to see if such method exists. Then, I came across <code class="highlighter-rouge">Array#fetch</code> while scrolling through the documetantion.</p>

<h3 id="arrayfetch">Array#fetch</h3>

<p>In Ruby <code class="highlighter-rouge">Array</code>, <code class="highlighter-rouge">fetch</code> is a method that get the value at position <code class="highlighter-rouge">index</code> of an array. The difference between <code class="highlighter-rouge">fetch</code> and <code class="highlighter-rouge">.[]</code> is <code class="highlighter-rouge">fetch</code> throws an <code class="highlighter-rouge">IndexError</code> if the index doesn’t exists.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">array</span><span class="p">.</span><span class="nf">fetch</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1">#=&gt; 1</span>
<span class="n">array</span><span class="p">.</span><span class="nf">fetch</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="c1">#=&gt; IndexError: index 4 outside of array bounds: -3...3</span>
</code></pre></div></div>

<p>If we take a look at the Ruby documentation of <a href="https://ruby-doc.org/core-2.4.0/Array.html#method-i-fetch">Array#fetch</a>, we’ll see that <code class="highlighter-rouge">fetch</code> has the following definitions:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fetch</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="no">Object</span>
<span class="n">fetch</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="no">Object</span>
<span class="n">fetch</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">index</span><span class="o">|</span> <span class="n">block</span> <span class="p">}</span> <span class="o">-&gt;</span> <span class="no">Object</span>
</code></pre></div></div>

<p>Which means, we can also provide a default value as the result if the index isn’t found. For example:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">array</span><span class="p">.</span><span class="nf">fetch</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="c1">#=&gt; 0</span>
</code></pre></div></div>

<p>Or provide a block to be executed if the index is not found:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">array</span><span class="p">.</span><span class="nf">fetch</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">index</span><span class="o">|</span> <span class="s2">"The index '</span><span class="si">#{</span><span class="n">index</span><span class="si">}</span><span class="s2">' is not found"</span> <span class="p">}</span>
<span class="c1">#=&gt; "The index '4' is not found"</span>
</code></pre></div></div>

<h3 id="possible-use-case">Possible Use Case</h3>

<p><code class="highlighter-rouge">Array#fetch</code> can be used when we need to provide a default value if the index is not found.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">users</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Peter'</span><span class="p">,</span> <span class="s1">'Jane'</span><span class="p">,</span> <span class="s1">'John Wick'</span><span class="p">]</span>
<span class="nb">name</span> <span class="o">=</span> <span class="n">users</span><span class="p">.</span><span class="nf">fetch</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">'User not found'</span><span class="p">)</span>

<span class="nb">puts</span> <span class="nb">name</span>
<span class="s2">"User not found"</span>
<span class="c1">#=&gt; nil</span>
</code></pre></div></div>

<p>For example, we have a method to allow to search other users <em>(which store in array)</em> and print out the name as a response. To handle the scenario where the user is not found, we can implement it by providing a default value with <code class="highlighter-rouge">Array#fetch</code>. No additional handling code is required.</p>

<p>If you know the other possible use cases of <code class="highlighter-rouge">Array#fetch</code>, feel free to share it out.</p>


  </div>

  
    

  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = 'https://kw7oe.github.io/ruby/2017/11/04/ruby-fetch.html';
      this.page.identifier = 'https://kw7oe.github.io/ruby/2017/11/04/ruby-fetch.html';
    };

    (function() {
      var d = document, s = d.createElement('script');

      s.src = 'https://kw7oe-github-io.disqus.com/embed.js';

      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>


  
</article>

  </main>
</div>

    
    <script src="/assets/custom.js"></script>
  </body>

</html>
